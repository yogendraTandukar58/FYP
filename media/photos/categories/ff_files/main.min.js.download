
function loadMessage(){const decodedOptions=getDecodedQueryParam('options');if(!decodedOptions)return;try{var options=JSON.parse(decodedOptions);if(options.properties&&options.properties.gist&&options.properties.gist.encodedMessageHtml){var encodedMessageHtml=options.properties.gist.encodedMessageHtml;var messageId=options.messageId;var instanceId=options.instanceId;embedMessageIntoBody(encodedMessageHtml,instanceId,messageId);}else{addDartRendererJs();}}catch(error){console.error("Parsing error:",error);}}
function addDartRendererJs(){var script=getScriptElement();script.src='main.dart.js';script.async=true;document.head.appendChild(script);}
function loadScriptWithCallback(scriptName,callback){var script=getScriptElement();script.src=scriptName;script.onreadystatechange=callback;script.onload=callback;document.head.appendChild(script);}
function embedMessageIntoBody(encodedMessageHtml,instanceId,messageId){const binaryString=atob(encodedMessageHtml);const charData=binaryString.split('').map(function(x){return x.charCodeAt(0);});const binData=new Uint8Array(charData);loadScriptWithCallback('pako_inflate.min.js',function(){const data=pako.inflate(binData);const messageHtml=new TextDecoder('utf-8').decode(data);loadHTMLMessage(messageHtml,instanceId,messageId);});}
function loadHTMLMessage(messageHtml,instanceId,messageId){const parser=new DOMParser();const doc=parser.parseFromString(messageHtml,'text/html');loadScriptWithCallback('bridge.min.js',function(){messageLoaded(instanceId,messageId);});document.head.innerHTML+=doc.head.innerHTML;document.body.innerHTML=doc.body.innerHTML;}
function getDecodedQueryParam(param){const queryString=window.location.search.substring(1);const urlParams=new URLSearchParams(queryString);let encodedValue=urlParams.get(param);if(encodedValue){encodedValue=encodedValue.replace(/-/g,'+').replace(/_/g,'/');try{const decodedValue=atob(encodedValue);return decodedValue;}catch(e){console.error('There was an error decoding the parameter:',e);}}else{console.warn('Parameter not found:',param);}
return null;}
function getScriptElement(){var scriptElement=document.createElement('script');scriptElement.type='text/javascript';return scriptElement;}
loadMessage();